import{D as H,a as M,b as J,c as U,L as B,j as e,r as d,F as Y}from"./index-02VvnAZk.js";import{u as K}from"./useAuth-Bm9JZj82.js";class T extends Error{constructor(o,s){super(o),this.statusCode=s,this.name="ApiError"}}const g=async(t,o={})=>{try{const s=await fetch(t,o);if(!s.ok)throw new T(`API request failed: ${s.statusText}`,s.status);return s.json()}catch(s){throw s instanceof T?s:s instanceof Error?new Error(`Network or other error: ${s.message}`):new Error("An unknown error occurred")}},V=async()=>await g(U,{method:"GET",credentials:"include"}),W=async({size:t=25,from:o=0,breeds:s=[],zipCodes:c=[],sort:r="breed:asc"})=>{const a=new URLSearchParams({size:t.toString(),from:o.toString(),sort:r});s.length!==0&&a.append("breeds",s.join(",")),c.length!==0&&c.forEach(n=>a.append("zipCodes",n));const l=`${H}?${a.toString()}`;try{const{resultIds:n,total:h}=await g(l,{method:"GET",credentials:"include"});return{dogs:n.length>0?await R(n):[],total:h}}catch(n){return console.error("Error fetching dogs:",n),{dogs:[],total:0}}},R=async t=>await g(M,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"}),q=async t=>{const{match:o}=await g(J,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"});return(await g(M,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([o]),credentials:"include"}))[0]},X=async(t,o)=>{const c={city:t,states:[o]};try{const{results:r}=await g(B,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c),credentials:"include"});if(r.length===0)throw new Error("City not found");return{latitude:r[0].latitude,longitude:r[0].longitude}}catch(r){throw console.error("Error fetching city coordinates:",r),new Error("Unable to fetch city coordinates. Please try again")}},Q=(t,o,s)=>{const r=s/3959*(180/Math.PI),a=s/(3959*Math.cos(Math.PI*t/180))*(180/Math.PI);return{bottom_left:{lat:t-r,lon:o-a},top_right:{lat:t+r,lon:o+a}}},ee=async(t,o,s)=>{const c=[];let r=0;const a=25;try{const l=Q(t,o,s);for(;;){const{results:n}=await g(B,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({geoBoundingBox:l,from:r,size:a}),credentials:"include"});if(!n.length)break;c.push(...n.map(h=>h.zip_code)),r+=a}return c}catch(l){throw console.error("Error fetching ZIP codes:",l),new Error("Unable to fetch ZIP codes. Please try again")}},te=async({city:t="",states:o=[],radius:s=25})=>{if(!t||o.length===0||isNaN(s)||s<=0)return console.warn("Invalid input for fetching zip codes."),[];try{const{latitude:c,longitude:r}=await X(t,o[0]);if(!c||!r)return console.warn("City coordinates not found."),[];const a=await ee(c,r,s);return a.length===0&&console.warn("No zip codes found for the given city and radius."),a}catch(c){return console.error("Fetch Location failed:",c),[]}},se=()=>{const{logout:t}=K(),o=async()=>{try{await t()}catch(s){console.error("Logout failed:",s)}};return e.jsx("button",{onClick:o,children:"Logout"})},y=()=>{const t=d.useContext(Y);if(!t)throw new Error("useFavorites must be used within a FavoritesProvider");return t},oe=({selectedBreed:t,onBreedSelect:o})=>{const[s,c]=d.useState([]);d.useEffect(()=>{(async()=>{const l=await V();c(l)})()},[]);const r=a=>{const l=a.target.value===""?"":a.target.value;o(l?[l]:[])};return e.jsxs("div",{className:"breed-filter",children:[e.jsx("label",{htmlFor:"breed-select",children:"Breed filter "}),e.jsxs("select",{id:"breed-select",value:t,onChange:r,children:[e.jsx("option",{value:"",children:"All Breeds"},"all-breeds"),s.map(a=>e.jsx("option",{value:a,children:a},a))]})]})},ne=["AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"],ae=[5,10,25,50,100],re=({city:t,setCity:o,state:s,setState:c,radius:r,setRadius:a,onFilter:l})=>e.jsxs("div",{className:"location-filters",children:[e.jsxs("span",{className:"city-container",children:[e.jsx("label",{htmlFor:"city",children:"City"}),e.jsx("input",{id:"city",type:"string",value:t,onChange:n=>o(n.target.value)})]}),e.jsx("span",{children:e.jsxs("select",{id:"state-select",value:s,onChange:n=>c(n.target.value),children:[e.jsx("option",{value:"",children:"Select State"},"all-states"),ne.map(n=>e.jsx("option",{value:n,children:n},n))]})}),e.jsx("span",{children:e.jsxs("select",{id:"radius-select",value:r,onChange:n=>a(n.target.value||void 0),children:[e.jsx("option",{value:"",children:"Radius"},"all-radius"),ae.map(n=>e.jsxs("option",{value:n,children:[n," miles"]},n))]})}),e.jsx("button",{onClick:l,children:"Apply Location Filter"})]}),ie=[{param:"breed:asc",name:"Breed A-Z"},{param:"breed:desc",name:"Breed Z-A"},{param:"name:asc",name:"Name A-Z"},{param:"name:desc",name:"Name Z-A"},{param:"age:asc",name:"Youngest to Oldest"},{param:"age:desc",name:"Oldest to Youngest"}],ce=({selectedSortOption:t,onSortOptionChange:o})=>e.jsxs("div",{className:"sort-options-container",children:[e.jsx("label",{htmlFor:"sort-options",children:"Sort Options "}),e.jsx("select",{id:"sort-options",value:t,onChange:s=>o(s.target.value),children:ie.map(({param:s,name:c})=>e.jsx("option",{value:s,children:c},s))})]}),le=({selectedBreeds:t,onBreedSelect:o,selectedSortOption:s,onSortOptionChange:c,city:r,setCity:a,state:l,setState:n,radius:h,setRadius:i,onApplyFilter:m})=>e.jsxs("div",{children:[e.jsxs("div",{className:"search-options",children:[e.jsx(oe,{selectedBreed:t,onBreedSelect:o}),e.jsx(ce,{selectedSortOption:s,onSortOptionChange:c}),e.jsx(re,{city:r,setCity:a,state:l,setState:n,radius:h,setRadius:i,onFilter:m})]}),e.jsx("button",{onClick:()=>{o([]),c("breed:asc"),a(""),n(""),i(void 0),m(!0)},children:"Reset Filters"})]}),N=({dog:t,onFavoriteClick:o,isFavorite:s})=>e.jsxs("div",{className:"dog-card",children:[e.jsx("img",{src:t.img,alt:t.name,className:"dog-image"}),e.jsxs("div",{className:"dog-info",children:[e.jsx("h2",{children:t.name}),e.jsxs("p",{children:[e.jsx("strong",{children:"Breed:"})," ",t.breed]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Age:"})," ",t.age," years"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Location:"})," ZIP ",t.zip_code]}),e.jsx("button",{className:`favorite-btn ${s?"favorited":""}`,onClick:()=>o?o(t.id):{},children:s?"★ Favorited":"☆ Favorite"})]})]}),de=({currentPage:t,totalPages:o,onPageChange:s})=>{const c=[1,2,3].filter(i=>i<=o),r=[o-2,o-1,o].filter(i=>i>3),a=3;let l=Math.max(4,t-Math.floor(a/2));const n=Math.min(o-3,l+a-1);n-l<a-1&&(l=Math.max(4,n-a+1));const h=[];for(let i=l;i<=n;i++)h.push(i);return e.jsxs("div",{className:"pagination-container",children:[e.jsx("button",{onClick:()=>s(t-1),disabled:t===1,className:"pagination-button previous","aria-label":"Previous page",children:"Previous"}),c.map(i=>e.jsx("button",{onClick:()=>s(i),className:`pagination-button ${i===t?"active":""}`,"aria-current":i===t?"page":void 0,children:i},i)),l>4&&e.jsx("span",{className:"ellipsis",children:"..."}),h.map(i=>e.jsx("button",{onClick:()=>s(i),className:`pagination-button ${i===t?"active":""}`,"aria-current":i===t?"page":void 0,children:i},i)),n<o-3&&e.jsx("span",{className:"ellipsis",children:"..."}),r.map(i=>e.jsx("button",{onClick:()=>s(i),className:`pagination-button ${i===t?"active":""}`,"aria-current":i===t?"page":void 0,children:i},i)),e.jsx("button",{onClick:()=>s(t+1),disabled:t===o,className:"pagination-button next","aria-label":"Next page",children:"Next"})]})},I=25,he=()=>{const[t,o]=d.useState([]),[s,c]=d.useState([]),[r,a]=d.useState("breed:asc"),[l,n]=d.useState(1),[h,i]=d.useState(0),[m,k]=d.useState(""),[b,L]=d.useState(void 0),[C,_]=d.useState(void 0),[j,D]=d.useState(void 0),[x,O]=d.useState(void 0),[v,w]=d.useState(void 0),[S,A]=d.useState([]),[P,f]=d.useState(!0),[E,F]=d.useState(null),{favorites:z,toggleFavorite:Z}=y();d.useEffect(()=>{if(!j&&!x&&!v)return;const u=async()=>{try{const p=await te({city:j??"",states:x?[x]:[],radius:Number(v)});A(p)}catch(p){F(`Failed to load zip codes: ${p}`)}finally{f(!1)}};f(!0),u()},[j,x,v]),d.useEffect(()=>{(async()=>{o([]),f(!0);try{const{dogs:p,total:G}=await W({from:(l-1)*I,breeds:s||void 0,sort:r,zipCodes:S.length!==0?S:void 0});o(p),i(G)}catch(p){F(`Failed to load dogs: ${p}`)}finally{f(!1)}})()},[l,s,r,S]);const $=u=>{u===!0?(D(void 0),O(void 0),w(void 0),A([])):(D(m),O(b),w(C)),n(1)};return P?e.jsx("p",{children:"Loading..."}):E?e.jsx("p",{children:E}):e.jsxs(e.Fragment,{children:[e.jsx(le,{selectedBreeds:s,onBreedSelect:c,selectedSortOption:r,onSortOptionChange:a,city:m,setCity:k,state:b,setState:L,radius:C,setRadius:_,onApplyFilter:$}),e.jsx(de,{currentPage:l,totalPages:Math.ceil(h/I),onPageChange:n}),e.jsx("div",{className:"dog-list",children:t.map(u=>e.jsx(N,{dog:u,isFavorite:z.has(u.id),onFavoriteClick:Z},u.id))})]})},ue=({dog:t})=>e.jsx(e.Fragment,{children:t?e.jsx("div",{className:"matching-dog",children:e.jsx(N,{dog:t,isFavorite:!1,onFavoriteClick:()=>{}},t.id)}):null}),pe=({onFavoriteClick:t})=>{const{favorites:o}=y(),[s,c]=d.useState([]),[r,a]=d.useState(null);d.useEffect(()=>{(async()=>{if(o.size===0){c([]);return}try{const h=await R(Array.from(o));c(h)}catch(h){console.error("Failed to load favorite dogs:",h)}})()},[o]);const l=async()=>{const n=s.map(h=>h.id);try{const h=await q(n);a(h)}catch(h){console.log("Failed to get matching dog:",h)}};return e.jsxs("div",{children:[e.jsx("h2",{children:"Favorite Dogs"}),s.length===0?e.jsx("p",{children:"No favorites yet! ❤️"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"dog-list",children:s.map(n=>e.jsx(N,{dog:n,isFavorite:!0,onFavoriteClick:t},n.id))}),e.jsx("button",{onClick:l,children:"Get Matching Dog"}),r&&e.jsxs("div",{className:"matching-dog-container",children:[e.jsx("h3",{children:"Matched Dog"}),e.jsx(ue,{dog:r})]})]})]})},ge=({activeTab:t,onTabChange:o})=>e.jsxs("div",{className:"tabs",children:[e.jsx("button",{className:t==="all"?"active":"",onClick:()=>o("all"),children:"All Dogs"}),e.jsx("button",{className:t==="favorites"?"active":"",onClick:()=>o("favorites"),children:"Favorite Dogs ❤️"})]});function fe(){const[t,o]=d.useState("all"),{toggleFavorite:s}=y();return e.jsxs("div",{children:[e.jsxs("div",{className:"sticky-header",children:[e.jsx("h1",{children:"Search for dogs"}),e.jsx(ge,{activeTab:t,onTabChange:o}),e.jsx("span",{className:"logout-btn",children:e.jsx(se,{})})]}),t==="all"&&e.jsx(he,{}),t==="favorites"&&e.jsx(pe,{onFavoriteClick:s})]})}export{fe as default};
