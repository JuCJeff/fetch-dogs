import{D as J,a as P,b as U,c as Y,L as _,j as e,r as h,F as K}from"./index-BFEg6y9E.js";import{u as V}from"./useAuth-Cb9WswbX.js";class k extends Error{constructor(o,s){super(o),this.statusCode=s,this.name="ApiError"}}const g=async(t,o={})=>{try{const s=await fetch(t,o);if(!s.ok)throw new k(`API request failed: ${s.statusText}`,s.status);return s.json()}catch(s){throw s instanceof k?s:s instanceof Error?new Error(`Network or other error: ${s.message}`):new Error("An unknown error occurred")}},W=async()=>await g(Y,{method:"GET",credentials:"include"}),q=async({size:t=25,from:o=0,breeds:s=[],zipCodes:i=[],sort:a="breed:asc"})=>{const r=new URLSearchParams({size:t.toString(),from:o.toString(),sort:a});s.length!==0&&r.append("breeds",s.join(",")),i.length!==0&&i.forEach(n=>r.append("zipCodes",n));const l=`${J}?${r.toString()}`;try{const{resultIds:n,total:d}=await g(l,{method:"GET",credentials:"include"});return{dogs:n.length>0?await z(n):[],total:d}}catch(n){return console.error("Error fetching dogs:",n),{dogs:[],total:0}}},z=async t=>await g(P,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"}),X=async t=>{const{match:o}=await g(U,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"});return(await g(P,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([o]),credentials:"include"}))[0]},Q=async(t,o)=>{const i={city:t,states:[o]};try{const{results:a}=await g(_,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i),credentials:"include"});if(a.length===0)throw new Error("City not found");return{latitude:a[0].latitude,longitude:a[0].longitude}}catch(a){throw console.error("Error fetching city coordinates:",a),new Error("Unable to fetch city coordinates. Please try again")}},ee=(t,o,s)=>{const a=s/3959*(180/Math.PI),r=s/(3959*Math.cos(Math.PI*t/180))*(180/Math.PI);return{bottom_left:{lat:t-a,lon:o-r},top_right:{lat:t+a,lon:o+r}}},te=async(t,o,s)=>{const i=[];let a=0;const r=25;try{const l=ee(t,o,s);for(;;){const{results:n}=await g(_,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({geoBoundingBox:l,from:a,size:r}),credentials:"include"});if(!n.length)break;i.push(...n.map(d=>d.zip_code)),a+=r}return i}catch(l){throw console.error("Error fetching ZIP codes:",l),new Error("Unable to fetch ZIP codes. Please try again")}},se=async({city:t="",states:o=[],radius:s=25})=>{if(!t||o.length===0||isNaN(s)||s<=0)return console.warn("Invalid input for fetching zip codes."),[];try{const{latitude:i,longitude:a}=await Q(t,o[0]);if(!i||!a)return console.warn("City coordinates not found."),[];const r=await te(i,a,s);return r.length===0&&console.warn("No zip codes found for the given city and radius."),r}catch(i){return console.error("Fetch Location failed:",i),[]}},oe=()=>{const{logout:t}=V(),o=async()=>{try{await t()}catch(s){console.error("Logout failed:",s)}};return e.jsx("button",{onClick:o,children:"Logout"})},w=({dog:t,onFavoriteClick:o,isFavorite:s})=>e.jsxs("div",{className:"dog-card",children:[e.jsx("img",{src:t.img,alt:t.name,className:"dog-image"}),e.jsxs("div",{className:"dog-info",children:[e.jsx("h2",{children:t.name}),e.jsxs("p",{children:[e.jsx("strong",{children:"Breed:"})," ",t.breed]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Age:"})," ",t.age," years"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Location:"})," ZIP ",t.zip_code]}),o&&e.jsx("button",{className:`favorite-btn ${s?"favorited":""}`,onClick:()=>o(t.id),children:s?"★ Favorited":"☆ Favorite"})]})]}),ne=({activeTab:t,onTabChange:o})=>e.jsxs("div",{className:"tabs",children:[e.jsx("button",{className:t==="all"?"active":"",onClick:()=>o("all"),children:"All Dogs"}),e.jsx("button",{className:t==="favorites"?"active":"",onClick:()=>o("favorites"),children:"Favorite Dogs ❤️"})]}),A=()=>{const t=h.useContext(K);if(!t)throw new Error("useFavorites must be used within a FavoritesProvider");return t},re=({selectedBreed:t,onBreedSelect:o})=>{const[s,i]=h.useState([]);h.useEffect(()=>{(async()=>{const l=await W();i(l)})()},[]);const a=r=>{const l=r.target.value===""?"":r.target.value;o(l?[l]:[])};return e.jsxs("div",{className:"breed-filter",children:[e.jsx("label",{htmlFor:"breed-select",children:"Breed filter: "}),e.jsxs("select",{id:"breed-select",value:t,onChange:a,children:[e.jsx("option",{value:"",children:"All Breeds"},"all-breeds"),s.map(r=>e.jsx("option",{value:r,children:r},r))]})]})},ae=["AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"],ie=[5,10,25,50,100],ce=({city:t,setCity:o,state:s,setState:i,radius:a,setRadius:r,onFilter:l})=>e.jsxs("div",{className:"location-filters",children:[e.jsxs("span",{children:[e.jsx("label",{htmlFor:"city",children:"City"}),e.jsx("input",{id:"city",type:"string",value:t,onChange:n=>o(n.target.value)})]}),e.jsx("span",{children:e.jsxs("select",{id:"state-select",value:s,onChange:n=>i(n.target.value),children:[e.jsx("option",{value:"",children:"Select State"},"all-states"),ae.map(n=>e.jsx("option",{value:n,children:n},n))]})}),e.jsx("span",{children:e.jsxs("select",{id:"radius-select",value:a,onChange:n=>r(n.target.value||void 0),children:[e.jsx("option",{value:"",children:"Radius"},"all-radius"),ie.map(n=>e.jsxs("option",{value:n,children:[n," miles"]},n))]})}),e.jsx("button",{onClick:l,children:"Apply Location Filter"})]}),le=[{param:"breed:asc",name:"Breed A-Z"},{param:"breed:desc",name:"Breed Z-A"},{param:"name:asc",name:"Name A-Z"},{param:"name:desc",name:"Name Z-A"},{param:"age:asc",name:"Youngest to Oldest"},{param:"age:desc",name:"Oldest to Youngest"}],de=({selectedSortOption:t,onSortOptionChange:o})=>e.jsxs("div",{className:"sort-options-container",children:[e.jsx("label",{htmlFor:"sort-options",children:"Sort Options "}),e.jsx("select",{id:"sort-options",value:t,onChange:s=>o(s.target.value),children:le.map(({param:s,name:i})=>e.jsx("option",{value:s,children:i},s))})]}),he=({selectedBreeds:t,onBreedSelect:o,selectedSortOption:s,onSortOptionChange:i,city:a,setCity:r,state:l,setState:n,radius:d,setRadius:c,onApplyFilter:p})=>e.jsxs("div",{children:[e.jsxs("div",{className:"search-options",children:[e.jsx(re,{selectedBreed:t,onBreedSelect:o}),e.jsx(de,{selectedSortOption:s,onSortOptionChange:i}),e.jsx(ce,{city:a,setCity:r,state:l,setState:n,radius:d,setRadius:c,onFilter:p})]}),e.jsx("button",{onClick:()=>{o([]),i("breed:asc"),r(""),n(""),c(void 0),p(!0)},children:"Reset Filters"})]}),ue=({currentPage:t,totalPages:o,onPageChange:s})=>{const i=[1,2,3].filter(c=>c<=o),a=[o-2,o-1,o].filter(c=>c>3),r=3;let l=Math.max(4,t-Math.floor(r/2));const n=Math.min(o-3,l+r-1);n-l<r-1&&(l=Math.max(4,n-r+1));const d=[];for(let c=l;c<=n;c++)d.push(c);return e.jsxs("div",{className:"pagination",children:[e.jsx("button",{onClick:()=>s(t-1),disabled:t===1,children:"Previous"}),i.map(c=>e.jsx("button",{onClick:()=>s(c),className:c===t?"active":"",children:c},c)),l>4&&e.jsx("span",{children:"..."}),d.map(c=>e.jsx("button",{onClick:()=>s(c),className:c===t?"active":"",children:c},c)),n<o-3&&e.jsx("span",{children:"..."}),a.map(c=>e.jsx("button",{onClick:()=>s(c),className:c===t?"active":"",children:c},c)),e.jsx("button",{onClick:()=>s(t+1),disabled:t===o,children:"Next"})]})},ge=25,pe=({dogs:t,totalDogs:o,selectedBreeds:s,onBreedSelect:i,selectedSortOption:a,onSortOptionChange:r,currentPage:l,onPageChange:n,city:d,setCity:c,state:p,setState:N,radius:x,setRadius:C,onApplyFilter:f})=>{const{favorites:b,toggleFavorite:j}=A();return e.jsxs(e.Fragment,{children:[e.jsx(he,{selectedBreeds:s,onBreedSelect:i,selectedSortOption:a,onSortOptionChange:r,city:d,setCity:c,state:p,setState:N,radius:x,setRadius:C,onApplyFilter:f}),e.jsx("div",{className:"dog-list",children:t.map(m=>e.jsx(w,{dog:m,isFavorite:b.has(m.id),onFavoriteClick:j},m.id))}),e.jsx(ue,{currentPage:l,totalPages:Math.ceil(o/ge),onPageChange:n})]})},me=({dog:t})=>e.jsx(e.Fragment,{children:t?e.jsx("div",{className:"matching-dog",children:e.jsx(w,{dog:t,isFavorite:!1,onFavoriteClick:()=>{}},t.id)}):null}),xe=({onFavoriteClick:t})=>{const{favorites:o}=A(),[s,i]=h.useState([]),[a,r]=h.useState(null);h.useEffect(()=>{(async()=>{if(o.size===0){i([]);return}try{const d=await z(Array.from(o));i(d)}catch(d){console.error("Failed to load favorite dogs:",d)}})()},[o]);const l=async()=>{const n=s.map(d=>d.id);try{const d=await X(n);r(d)}catch(d){console.log("Failed to get matching dog:",d)}};return e.jsxs("div",{children:[e.jsx("h2",{children:"Favorite Dogs"}),s.length===0?e.jsx("p",{children:"No favorites yet! ❤️"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"dog-list",children:s.map(n=>e.jsx(w,{dog:n,isFavorite:!0,onFavoriteClick:t},n.id))}),e.jsx("button",{onClick:l,children:"Get Matching Dog"}),a&&e.jsxs("div",{className:"matching-dog-container",children:[e.jsx("h3",{children:"Matched Dog"}),e.jsx(me,{dog:a})]})]})]})},L=25,fe=()=>{const[t,o]=h.useState("all"),[s,i]=h.useState([]),[a,r]=h.useState([]),[l,n]=h.useState("breed:asc"),[d,c]=h.useState(1),[p,N]=h.useState(0),[x,C]=h.useState(""),[f,b]=h.useState(void 0),[j,m]=h.useState(void 0),[D,F]=h.useState(void 0),[v,T]=h.useState(void 0),[O,I]=h.useState(void 0),[E,M]=h.useState([]),[Z,S]=h.useState(!0),[B,R]=h.useState(null),{toggleFavorite:G}=A();h.useEffect(()=>{if(!D&&!v&&!O)return;const y=async()=>{try{const u=await se({city:D??"",states:v?[v]:[],radius:Number(O)});console.log("25 miles: ",u),M(u)}catch(u){R(`Failed to load zip codes: ${u}`)}finally{S(!1)}};S(!0),y()},[D,v,O]),h.useEffect(()=>{if(t==="favorites")return;(async()=>{S(!0);try{const{dogs:u,total:H}=await q({size:L,from:(d-1)*L,breeds:a||void 0,sort:l,zipCodes:E.length!==0?E:void 0});console.log(u),i(u),N(H)}catch(u){R(`Failed to load dogs: ${u}`)}finally{S(!1)}})()},[d,t,a,l,E]);const $=y=>{y===!0?(F(void 0),T(void 0),I(void 0),M([])):(F(x),T(f),I(j)),c(1)};return Z?e.jsx("p",{children:"Loading..."}):B?e.jsx("p",{children:B}):e.jsxs("div",{children:[e.jsxs("div",{className:"sticky-header",children:[e.jsx("h1",{children:"Search for dogs"}),e.jsx(ne,{activeTab:t,onTabChange:o}),e.jsx("span",{className:"logout-btn",children:e.jsx(oe,{})})]}),e.jsxs("div",{children:[t==="all"&&e.jsx(pe,{dogs:s,totalDogs:p,selectedBreeds:a,onBreedSelect:r,selectedSortOption:l,onSortOptionChange:n,currentPage:d,onPageChange:c,city:x,setCity:C,state:f,setState:b,radius:j,setRadius:m,onApplyFilter:$}),t==="favorites"&&e.jsx(xe,{onFavoriteClick:G})]})]})};function Se(){return e.jsx("div",{children:e.jsx(fe,{})})}export{Se as default};
