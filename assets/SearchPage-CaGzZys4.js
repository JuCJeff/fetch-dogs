import{D as U,a as M,b as H,c as J,L as R,j as e,r as d,F as Y}from"./index-1rkkicP_.js";import{u as K}from"./useAuth-Cjgg5NF9.js";class T extends Error{constructor(o,s){super(o),this.statusCode=s,this.name="ApiError"}}const p=async(t,o={})=>{try{const s=await fetch(t,o);if(!s.ok)throw new T(`API request failed: ${s.statusText}`,s.status);return s.json()}catch(s){throw s instanceof T?s:s instanceof Error?new Error(`Network or other error: ${s.message}`):new Error("An unknown error occurred")}},V=async()=>await p(J,{method:"GET",credentials:"include"}),W=async({size:t=25,from:o=0,breeds:s=[],zipCodes:i=[],sort:a="breed:asc"})=>{const r=new URLSearchParams({size:t.toString(),from:o.toString(),sort:a});s.length!==0&&r.append("breeds",s.join(",")),i.length!==0&&i.forEach(n=>r.append("zipCodes",n)),console.log(r.toString());const l=`${U}?${r.toString()}`;console.log(decodeURIComponent(r.toString()));try{const{resultIds:n,total:h}=await p(l,{method:"GET",credentials:"include"});return{dogs:n.length>0?await B(n):[],total:h}}catch(n){return console.error("Error fetching dogs:",n),{dogs:[],total:0}}},B=async t=>await p(M,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"}),q=async t=>{const{match:o}=await p(H,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"});return(await p(M,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([o]),credentials:"include"}))[0]},X=async(t,o)=>{const i={city:t,states:[o]};try{const{results:a}=await p(R,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i),credentials:"include"});if(a.length===0)throw new Error("City not found");return{latitude:a[0].latitude,longitude:a[0].longitude}}catch(a){throw console.error("Error fetching city coordinates:",a),new Error("Unable to fetch city coordinates. Please try again")}},Q=(t,o,s)=>{const a=s/3959*(180/Math.PI),r=s/(3959*Math.cos(Math.PI*t/180))*(180/Math.PI);return{bottom_left:{lat:t-a,lon:o-r},top_right:{lat:t+a,lon:o+r}}},ee=async(t,o,s)=>{const i=[];let a=0;const r=25;try{const l=Q(t,o,s);for(;;){const{results:n}=await p(R,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({geoBoundingBox:l,from:a,size:r}),credentials:"include"});if(!n.length)break;i.push(...n.map(h=>h.zip_code)),a+=r}return i}catch(l){throw console.error("Error fetching ZIP codes:",l),new Error("Unable to fetch ZIP codes. Please try again")}},te=async({city:t="",states:o=[],radius:s=25})=>{if(!t||o.length===0||isNaN(s)||s<=0)return console.warn("Invalid input for fetching zip codes."),[];try{const{latitude:i,longitude:a}=await X(t,o[0]);if(!i||!a)return console.warn("City coordinates not found."),[];const r=await ee(i,a,s);return r.length===0&&console.warn("No zip codes found for the given city and radius."),r}catch(i){return console.error("Fetch Location failed:",i),[]}},se=()=>{const{logout:t}=K(),o=async()=>{try{await t()}catch(s){console.error("Logout failed:",s)}};return e.jsx("button",{onClick:o,children:"Logout"})},y=()=>{const t=d.useContext(Y);if(!t)throw new Error("useFavorites must be used within a FavoritesProvider");return t},oe=({selectedBreed:t,onBreedSelect:o})=>{const[s,i]=d.useState([]);d.useEffect(()=>{(async()=>{const l=await V();i(l)})()},[]);const a=r=>{const l=r.target.value===""?"":r.target.value;o(l?[l]:[])};return e.jsxs("div",{className:"breed-filter",children:[e.jsx("label",{htmlFor:"breed-select",children:"Breed filter: "}),e.jsxs("select",{id:"breed-select",value:t,onChange:a,children:[e.jsx("option",{value:"",children:"All Breeds"},"all-breeds"),s.map(r=>e.jsx("option",{value:r,children:r},r))]})]})},ne=["AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"],re=[5,10,25,50,100],ae=({city:t,setCity:o,state:s,setState:i,radius:a,setRadius:r,onFilter:l})=>e.jsxs("div",{className:"location-filters",children:[e.jsxs("span",{children:[e.jsx("label",{htmlFor:"city",children:"City"}),e.jsx("input",{id:"city",type:"string",value:t,onChange:n=>o(n.target.value)})]}),e.jsx("span",{children:e.jsxs("select",{id:"state-select",value:s,onChange:n=>i(n.target.value),children:[e.jsx("option",{value:"",children:"Select State"},"all-states"),ne.map(n=>e.jsx("option",{value:n,children:n},n))]})}),e.jsx("span",{children:e.jsxs("select",{id:"radius-select",value:a,onChange:n=>r(n.target.value||void 0),children:[e.jsx("option",{value:"",children:"Radius"},"all-radius"),re.map(n=>e.jsxs("option",{value:n,children:[n," miles"]},n))]})}),e.jsx("button",{onClick:l,children:"Apply Location Filter"})]}),ie=[{param:"breed:asc",name:"Breed A-Z"},{param:"breed:desc",name:"Breed Z-A"},{param:"name:asc",name:"Name A-Z"},{param:"name:desc",name:"Name Z-A"},{param:"age:asc",name:"Youngest to Oldest"},{param:"age:desc",name:"Oldest to Youngest"}],ce=({selectedSortOption:t,onSortOptionChange:o})=>e.jsxs("div",{className:"sort-options-container",children:[e.jsx("label",{htmlFor:"sort-options",children:"Sort Options "}),e.jsx("select",{id:"sort-options",value:t,onChange:s=>o(s.target.value),children:ie.map(({param:s,name:i})=>e.jsx("option",{value:s,children:i},s))})]}),le=({selectedBreeds:t,onBreedSelect:o,selectedSortOption:s,onSortOptionChange:i,city:a,setCity:r,state:l,setState:n,radius:h,setRadius:c,onApplyFilter:m})=>e.jsxs("div",{children:[e.jsxs("div",{className:"search-options",children:[e.jsx(oe,{selectedBreed:t,onBreedSelect:o}),e.jsx(ce,{selectedSortOption:s,onSortOptionChange:i}),e.jsx(ae,{city:a,setCity:r,state:l,setState:n,radius:h,setRadius:c,onFilter:m})]}),e.jsx("button",{onClick:()=>{o([]),i("breed:asc"),r(""),n(""),c(void 0),m(!0)},children:"Reset Filters"})]}),N=({dog:t,onFavoriteClick:o,isFavorite:s})=>e.jsxs("div",{className:"dog-card",children:[e.jsx("img",{src:t.img,alt:t.name,className:"dog-image"}),e.jsxs("div",{className:"dog-info",children:[e.jsx("h2",{children:t.name}),e.jsxs("p",{children:[e.jsx("strong",{children:"Breed:"})," ",t.breed]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Age:"})," ",t.age," years"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Location:"})," ZIP ",t.zip_code]}),o&&e.jsx("button",{className:`favorite-btn ${s?"favorited":""}`,onClick:()=>o(t.id),children:s?"★ Favorited":"☆ Favorite"})]})]}),de=({currentPage:t,totalPages:o,onPageChange:s})=>{const i=[1,2,3].filter(c=>c<=o),a=[o-2,o-1,o].filter(c=>c>3),r=3;let l=Math.max(4,t-Math.floor(r/2));const n=Math.min(o-3,l+r-1);n-l<r-1&&(l=Math.max(4,n-r+1));const h=[];for(let c=l;c<=n;c++)h.push(c);return e.jsxs("div",{className:"pagination",children:[e.jsx("button",{onClick:()=>s(t-1),disabled:t===1,children:"Previous"}),i.map(c=>e.jsx("button",{onClick:()=>s(c),className:c===t?"active":"",children:c},c)),l>4&&e.jsx("span",{children:"..."}),h.map(c=>e.jsx("button",{onClick:()=>s(c),className:c===t?"active":"",children:c},c)),n<o-3&&e.jsx("span",{children:"..."}),a.map(c=>e.jsx("button",{onClick:()=>s(c),className:c===t?"active":"",children:c},c)),e.jsx("button",{onClick:()=>s(t+1),disabled:t===o,children:"Next"})]})},I=25,he=()=>{const[t,o]=d.useState([]),[s,i]=d.useState([]),[a,r]=d.useState("breed:asc"),[l,n]=d.useState(1),[h,c]=d.useState(0),[m,k]=d.useState(""),[C,L]=d.useState(void 0),[b,P]=d.useState(void 0),[v,D]=d.useState(void 0),[x,O]=d.useState(void 0),[f,w]=d.useState(void 0),[S,A]=d.useState([]),[_,j]=d.useState(!0),[E,F]=d.useState(null),{favorites:z,toggleFavorite:Z}=y();d.useEffect(()=>{if(!v&&!x&&!f)return;const g=async()=>{try{const u=await te({city:v??"",states:x?[x]:[],radius:Number(f)});console.log(`${f} miles: `,u),A(u)}catch(u){F(`Failed to load zip codes: ${u}`)}finally{j(!1)}};j(!0),g()},[v,x,f]),d.useEffect(()=>{(async()=>{j(!0);try{const{dogs:u,total:$}=await W({from:(l-1)*I,breeds:s||void 0,sort:a,zipCodes:S.length!==0?S:void 0});console.log(u),o(u),c($)}catch(u){F(`Failed to load dogs: ${u}`)}finally{j(!1)}})()},[l,s,a,S]);const G=g=>{g===!0?(D(void 0),O(void 0),w(void 0),A([])):(D(m),O(C),w(b)),n(1)};return _?e.jsx("p",{children:"Loading..."}):E?e.jsx("p",{children:E}):e.jsxs(e.Fragment,{children:[e.jsx(le,{selectedBreeds:s,onBreedSelect:i,selectedSortOption:a,onSortOptionChange:r,city:m,setCity:k,state:C,setState:L,radius:b,setRadius:P,onApplyFilter:G}),e.jsx("div",{className:"dog-list",children:t.map(g=>e.jsx(N,{dog:g,isFavorite:z.has(g.id),onFavoriteClick:Z},g.id))}),e.jsx(de,{currentPage:l,totalPages:Math.ceil(h/I),onPageChange:n})]})},ue=({dog:t})=>e.jsx(e.Fragment,{children:t?e.jsx("div",{className:"matching-dog",children:e.jsx(N,{dog:t,isFavorite:!1,onFavoriteClick:()=>{}},t.id)}):null}),ge=({onFavoriteClick:t})=>{const{favorites:o}=y(),[s,i]=d.useState([]),[a,r]=d.useState(null);d.useEffect(()=>{(async()=>{if(o.size===0){i([]);return}try{const h=await B(Array.from(o));i(h)}catch(h){console.error("Failed to load favorite dogs:",h)}})()},[o]);const l=async()=>{const n=s.map(h=>h.id);try{const h=await q(n);r(h)}catch(h){console.log("Failed to get matching dog:",h)}};return e.jsxs("div",{children:[e.jsx("h2",{children:"Favorite Dogs"}),s.length===0?e.jsx("p",{children:"No favorites yet! ❤️"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"dog-list",children:s.map(n=>e.jsx(N,{dog:n,isFavorite:!0,onFavoriteClick:t},n.id))}),e.jsx("button",{onClick:l,children:"Get Matching Dog"}),a&&e.jsxs("div",{className:"matching-dog-container",children:[e.jsx("h3",{children:"Matched Dog"}),e.jsx(ue,{dog:a})]})]})]})},pe=({activeTab:t,onTabChange:o})=>e.jsxs("div",{className:"tabs",children:[e.jsx("button",{className:t==="all"?"active":"",onClick:()=>o("all"),children:"All Dogs"}),e.jsx("button",{className:t==="favorites"?"active":"",onClick:()=>o("favorites"),children:"Favorite Dogs ❤️"})]});function fe(){const[t,o]=d.useState("all"),{toggleFavorite:s}=y();return e.jsxs("div",{children:[e.jsxs("div",{className:"sticky-header",children:[e.jsx("h1",{children:"Search for dogs"}),e.jsx(pe,{activeTab:t,onTabChange:o}),e.jsx("span",{className:"logout-btn",children:e.jsx(se,{})})]}),t==="all"&&e.jsx(he,{}),t==="favorites"&&e.jsx(ge,{onFavoriteClick:s})]})}export{fe as default};
